---
import { getCollection } from 'astro:content';
import Base from "../../layouts/Base.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";

const posts = await getCollection('blog');
const tagCounts = new Map<string, number>();
for (const p of posts) {
  for (const t of (p.data.tags ?? [])) {
    tagCounts.set(t, (tagCounts.get(t) ?? 0) + 1);
  }
}
const tags = Array.from(tagCounts.entries()).sort((a,b) => b[1]-a[1]);
---
<Base title="Tags" description="Browse posts by tag">
  <Fragment slot="nav"><Navbar /></Fragment>
  <h1 class="text-4xl font-extrabold tracking-tight mb-6 text-center">Tags</h1>
  <div class="max-w-2xl mx-auto flex flex-wrap gap-3">
    {tags.map(([tag, count]) => (
      <a href={`/tags/${encodeURIComponent(tag)}`} class="no-underline">
        <span class="inline-flex items-center gap-2 bg-purple-700/20 text-[var(--accent)] px-3 py-1 rounded border border-[var(--border)]">
          #{tag}
          <span class="text-xs text-[var(--muted)]">{count}</span>
        </span>
      </a>
    ))}
  </div>
  <Fragment slot="footer"><Footer /></Fragment>
</Base>


---
import "../styles/global.css"; // Tailwind + Catppuccin tokens
const { title = "Santiago Quiroga â€” Portfolio", description = "" } = Astro.props;
---
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png?v=2" />
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg?v=2" />
    <meta name="theme-color" content="#cba6f7" />

    <!-- Canonical + Social -->
    {
      // Build absolute URLs when possible
      (() => {
        const site = Astro.site?.href ?? (import.meta.env.SITE ?? "");
        const pathname = Astro.url.pathname;
        const url = site ? new URL(pathname, site).href : undefined;
        const imagePath = '/social/og-default.svg?v=1';
        const image = site ? new URL(imagePath, site).href : imagePath;
        return (
          <>
            {url && <link rel="canonical" href={url} />}
            <meta property="og:type" content="website" />
            <meta property="og:title" content={title} />
            {description && <meta property="og:description" content={description} />}
            {url && <meta property="og:url" content={url} />}
            <meta property="og:image" content={image} />
            <meta property="og:image:width" content="1200" />
            <meta property="og:image:height" content="630" />
            <meta property="og:image:type" content="image/svg+xml" />
            <meta name="twitter:card" content="summary_large_image" />
            <meta name="twitter:title" content={title} />
            {description && <meta name="twitter:description" content={description} />}
            <meta name="twitter:image" content={image} />
          </>
        );
      })()
    }

    <!-- Set theme before paint -->
    <script is:inline>
      (() => {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const dark = saved ? saved === 'dark' : systemDark;
        if (dark) document.documentElement.classList.add('dark');
      })();
    </script>
  
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">



    <!-- KaTeX CSS for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
  </head>

  <body class="min-h-screen antialiased bg-[var(--bg)] text-[var(--text)]">
    <!-- Accessible skip link -->
    <a
      href="#main"
      class="sr-only focus:not-sr-only fixed left-3 top-3 z-50 rounded-lg border border-[var(--border)]
             bg-[var(--surface)] px-3 py-2 text-sm"
    >
      Skip to content
    </a>

    <header class="sticky top-0 z-50 border-b border-[var(--border)] header-bg">
      <div class="mx-auto max-w-4xl px-4">
        <slot name="nav" />
      </div>
    </header>

    <main id="main" class="mx-auto max-w-4xl px-4 py-10">
      <slot />
    </main>

    <footer class="border-t border-[var(--border)] py-8 mt-16">
      <div class="mx-auto max-w-4xl px-4">
        <slot name="footer" />
      </div>
    </footer>

    <!-- Toggle stronger header shadow after slight scroll -->
    <script is:inline>
      const onScroll = () => {
        document.body.classList.toggle('scrolled', window.scrollY > 4);
      };
      addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    </script>
  </body>
</html>

---
import "../styles/global.css"; // Tailwind + Catppuccin tokens
import { site as siteMeta } from "../lib/site";
const { title = siteMeta.title, description = siteMeta.description, image = siteMeta.image } = Astro.props as { title?: string; description?: string; image?: string };
const siteUrl = import.meta.env.SITE || siteMeta.url;
const pageUrl = new URL(Astro.url?.pathname || '/', siteUrl).toString();
---
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
    <meta name="description" content={description} />

    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32.png" />
    <link rel="icon" type="image/png" sizes="48x48" href="/assets/favicon-48.png" />
    <link rel="icon" type="image/png" sizes="64x64" href="/assets/favicon-64.png" />
    <link rel="icon" type="image/png" sizes="128x128" href="/assets/favicon-128.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="/assets/favicon-192.png" />
    <link rel="icon" type="image/png" sizes="256x256" href="/assets/favicon-256.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="/assets/favicon-512.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />
    <link rel="shortcut icon" href="/assets/favicon.ico" />
    <link rel="mask-icon" href="/assets/favicon.svg" color="#8839ef" />

    <!-- SEO / Open Graph -->
    <link rel="canonical" href={pageUrl} />
    <meta property="og:type" content="website" />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={pageUrl} />
    <meta property="og:image" content={image} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={image} />

    <!-- Set theme before paint -->
    <script is:inline>
      (() => {
        const saved = localStorage.getItem('theme');
        const systemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        const dark = saved ? saved === 'dark' : systemDark;
        if (dark) document.documentElement.classList.add('dark');
      })();
    </script>
  
    <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">



    <!-- KaTeX CSS for math rendering -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" crossorigin="anonymous">
  </head>

  <body class="min-h-screen antialiased bg-[var(--bg)] text-[var(--text)]">
    <!-- Accessible skip link -->
    <a
      href="#main"
      class="sr-only focus:not-sr-only fixed left-3 top-3 z-50 rounded-lg border border-[var(--border)]
             bg-[var(--surface)] px-3 py-2 text-sm"
    >
      Skip to content
    </a>

    <header class="sticky top-0 z-50 border-b border-[var(--border)] header-bg">
      <div class="mx-auto max-w-4xl px-4">
        <slot name="nav" />
      </div>
    </header>

    <main id="main" class="mx-auto max-w-4xl px-4 py-10">
      <slot />
    </main>

    <footer class="border-t border-[var(--border)] py-8 mt-16">
      <div class="mx-auto max-w-4xl px-4">
        <slot name="footer" />
      </div>
    </footer>

    <!-- Toggle stronger header shadow after slight scroll -->
    <script is:inline>
      const onScroll = () => {
        document.body.classList.toggle('scrolled', window.scrollY > 4);
      };
      addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    </script>
  </body>
</html>

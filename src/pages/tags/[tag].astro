---
import { getCollection } from 'astro:content';
import Base from "../../layouts/Base.astro";
import Navbar from "../../components/Navbar.astro";
import Footer from "../../components/Footer.astro";
import BlogCard from "../../components/BlogCard.astro";

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const tags = new Set<string>();
  for (const p of posts) {
    for (const t of (p.data.tags ?? [])) tags.add(t);
  }
  return Array.from(tags).map((t) => ({ params: { tag: t } }));
}

const { tag } = Astro.params;
const allPosts = await getCollection('blog');
const filtered = allPosts.filter((p) => (p.data.tags ?? []).includes(tag));
---
<Base title={`Tag: ${tag}`} description={`Posts tagged with ${tag}`}>
  <Fragment slot="nav"><Navbar /></Fragment>
  <h1 class="text-4xl font-extrabold tracking-tight mb-6 text-center">#{tag}</h1>
  <div class="max-w-2xl mx-auto">
    {filtered.map((post, idx) => (
      <BlogCard post={post} idx={idx} />
    ))}
  </div>
  <Fragment slot="footer"><Footer /></Fragment>
</Base>

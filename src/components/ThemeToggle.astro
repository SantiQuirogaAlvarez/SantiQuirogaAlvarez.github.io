<button
  id="theme-toggle"
  class="inline-flex items-center gap-2 rounded-xl border border-[var(--border)] bg-[var(--surface)] px-3 py-1.5 text-sm hover:bg-[var(--bg)]"
>
  <span id="theme-emoji" aria-hidden="true">🌙</span>
  <span class="hidden sm:inline">Theme</span>
</button>

<script is:inline>
  (function () {
    const root = document.documentElement;
    const btn = document.getElementById('theme-toggle');
    const emoji = document.getElementById('theme-emoji');

    // What the user prefers before we touch anything
    function wantsDark() {
      const saved = localStorage.getItem('theme');
      if (saved === 'dark') return true;
      if (saved === 'light') return false;
      return window.matchMedia('(prefers-color-scheme: dark)').matches;
    }

    function render() {
      const isDark = root.classList.contains('dark');
      // Show 🌙 when light (click -> go dark). Show ☀️ when dark (click -> go light).
      emoji.textContent = isDark ? '☀️' : '🌙';
      btn.setAttribute('aria-pressed', String(isDark));
      btn.setAttribute('aria-label', isDark ? 'Switch to light theme' : 'Switch to dark theme');
    }

    // Ensure initial state matches preference (in case Base.astro didn’t run yet)
    if (wantsDark()) root.classList.add('dark'); else root.classList.remove('dark');
    render();

    btn.addEventListener('click', () => {
      const nowDark = root.classList.toggle('dark');
      localStorage.setItem('theme', nowDark ? 'dark' : 'light');
      render();
    });
  })();
</script>
